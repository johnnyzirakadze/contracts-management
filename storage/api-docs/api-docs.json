{
    "openapi": "3.0.0",
    "info": {
        "title": "Contracts API",
        "version": "1.0.0"
    },
    "servers": [
        {
            "url": "/",
            "description": "Base server"
        }
    ],
    "paths": {
        "/api/audit-logs": {
            "get": {
                "tags": [
                    "Audit"
                ],
                "summary": "აუდიტის ჟურნალი - სიის ნახვა",
                "operationId": "8a24c03b06fe3071c4035f4176892716",
                "parameters": [
                    {
                        "name": "from",
                        "in": "query",
                        "description": "თარიღი - საწყისი (YYYY-MM-DD)",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "to",
                        "in": "query",
                        "description": "თარიღი - საბოლოო",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "table",
                        "in": "query",
                        "description": "ცხრილის სახელი",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "action",
                        "in": "query",
                        "description": "მოქმედება (create/update/delete/upload/unlink)",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/audit-logs/export": {
            "get": {
                "tags": [
                    "Audit"
                ],
                "summary": "აუდიტ-რეპორტი ექსპორტი CSV/JSON",
                "operationId": "299cd68c6a859cd284360cc0b9444c26",
                "parameters": [
                    {
                        "name": "format",
                        "in": "query",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "csv",
                                "json"
                            ]
                        }
                    },
                    {
                        "name": "from",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "to",
                        "in": "query",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "table",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "action",
                        "in": "query",
                        "schema": {
                            "type": "string"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/login": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "შესვლა და JWT ტოკენის მიღება",
                "description": "აბრუნებს access_token-ს JSON-ში და აყენებს refresh_token-ს HttpOnly ქუქიში",
                "operationId": "8dcb70df1020986038d098cc08d05dae",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "email",
                                    "password"
                                ],
                                "properties": {
                                    "email": {
                                        "type": "string",
                                        "format": "email",
                                        "example": "admin@example.com"
                                    },
                                    "password": {
                                        "type": "string",
                                        "example": "admin123"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "access_token": {
                                            "type": "string"
                                        },
                                        "token_type": {
                                            "type": "string"
                                        },
                                        "expires_in": {
                                            "type": "integer"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "422": {
                        "description": "Invalid credentials"
                    }
                }
            }
        },
        "/api/auth/me": {
            "get": {
                "tags": [
                    "Auth"
                ],
                "summary": "მიმდინარე მომხმარებლის მიღება",
                "operationId": "b9abb1a7a74670a19c215c2c133f14d8",
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/logout": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "გასვლა და ტოკენების გაუქმება",
                "description": "აუქმებს access_token-ს (Bearer) და შლის refresh_token ქუქის",
                "operationId": "69281b12abb272c76871f19cb17ca563",
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/auth/refresh": {
            "post": {
                "tags": [
                    "Auth"
                ],
                "summary": "JWT access_token-ის განახლება (HttpOnly refresh ქუქით)",
                "description": "იღებს refresh_token-ს ქუქიდან და აბრუნებს ახალ access_token-ს; აბრუნებს ახალ refresh ქუქისაც (როტაცია)",
                "operationId": "a009b44559da52df1c36e5e33edd40bc",
                "responses": {
                    "200": {
                        "description": "OK",
                        "content": {
                            "application/json": {
                                "schema": {
                                    "properties": {
                                        "access_token": {
                                            "type": "string"
                                        },
                                        "token_type": {
                                            "type": "string"
                                        },
                                        "expires_in": {
                                            "type": "integer"
                                        }
                                    },
                                    "type": "object"
                                }
                            }
                        }
                    },
                    "401": {
                        "description": "Unauthorized"
                    }
                }
            }
        },
        "/api/admin/users": {
            "get": {
                "tags": [
                    "Admin"
                ],
                "summary": "მომხმარებლების სია (მხოლოდ ადმინი)",
                "operationId": "7e5808dfe3df39c6bb572cd260b1aac2",
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Admin"
                ],
                "summary": "მომხმარებლის შექმნა (მხოლოდ ადმინი)",
                "operationId": "764009fcfc428f5e7cf976f3e247a206",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name",
                                    "email",
                                    "password",
                                    "role"
                                ],
                                "properties": {
                                    "name": {
                                        "type": "string"
                                    },
                                    "email": {
                                        "type": "string",
                                        "format": "email"
                                    },
                                    "password": {
                                        "type": "string",
                                        "minLength": 8
                                    },
                                    "role": {
                                        "type": "string",
                                        "enum": [
                                            "viewer",
                                            "editor",
                                            "approver",
                                            "admin"
                                        ]
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contractors": {
            "get": {
                "tags": [
                    "Contractors"
                ],
                "summary": "კონტრაგენტების სიის ნახვა/ძიება (სწრაფი შევსებისთვის)",
                "operationId": "ba6e97581a2f26840c9d7a4617df5da5",
                "parameters": [
                    {
                        "name": "name",
                        "in": "query",
                        "description": "ძიება სახელით/ტელეფონით/ელფოსტით",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "limit",
                        "in": "query",
                        "description": "რამდენი ჩანაწერი დავაბრუნოთ (default: 20, max: 100)",
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Contractors"
                ],
                "summary": "კონტრაგენტის შექმნა",
                "operationId": "8e5ed6d296b0b24548697fc44e094841",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "name"
                                ],
                                "properties": {
                                    "name": {
                                        "description": "დასახელება",
                                        "type": "string",
                                        "example": "შპს ახალი პარტნიორი"
                                    },
                                    "phone": {
                                        "description": "ტელეფონი (E.164)",
                                        "type": "string",
                                        "example": "+995595000003",
                                        "nullable": true
                                    },
                                    "email": {
                                        "description": "ელფოსტა",
                                        "type": "string",
                                        "example": "partner@example.com",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contractors/{id}": {
            "put": {
                "tags": [
                    "Contractors"
                ],
                "summary": "კონტრაგენტის რედაქტირება",
                "operationId": "5a6352a805d4178ca5c79e7c0dc5ca7c",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "name": {
                                        "description": "დასახელება",
                                        "type": "string",
                                        "example": "შპს პარტნიორი განახლებული"
                                    },
                                    "phone": {
                                        "description": "ტელეფონი (E.164)",
                                        "type": "string",
                                        "example": "+995595000004",
                                        "nullable": true
                                    },
                                    "email": {
                                        "description": "ელფოსტა",
                                        "type": "string",
                                        "example": "updated@example.com",
                                        "nullable": true
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "delete": {
                "tags": [
                    "Contractors"
                ],
                "summary": "კონტრაგენტის წაშლა",
                "operationId": "240ad80e5ca75268bf361931e20e8b13",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "Deleted"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contracts": {
            "get": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტების სიის ნახვა",
                "operationId": "d8997f490da9062b7b77f68eaa735f07",
                "parameters": [
                    {
                        "name": "party_name",
                        "in": "query",
                        "description": "ძიება მხოლოდ სახელით (party_name)",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "status",
                        "in": "query",
                        "description": "სტატუსი (მაგ: აქტივი, დასამტკიცებელი და სხვ.)",
                        "schema": {
                            "type": "string"
                        }
                    },
                    {
                        "name": "sign_date_from",
                        "in": "query",
                        "description": "ხელმოწერის თარიღი - საწყისი",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "sign_date_to",
                        "in": "query",
                        "description": "ხელმოწერის თარიღი - საბოლოო",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "expiry_date_from",
                        "in": "query",
                        "description": "ვადის თარიღი - საწყისი",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "expiry_date_to",
                        "in": "query",
                        "description": "ვადის თარიღი - საბოლოო",
                        "schema": {
                            "type": "string",
                            "format": "date"
                        }
                    },
                    {
                        "name": "sort_by",
                        "in": "query",
                        "description": "სორტირების ველი",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "id",
                                "contract_number",
                                "sign_date",
                                "expiry_date",
                                "amount",
                                "created_at",
                                "updated_at"
                            ]
                        }
                    },
                    {
                        "name": "sort_dir",
                        "in": "query",
                        "description": "სორტირების მიმართულება",
                        "schema": {
                            "type": "string",
                            "enum": [
                                "asc",
                                "desc"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტის შექმნა",
                "operationId": "674f25b6428b177ae2a1fe1123b4dcf6",
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "required": [
                                    "party_name",
                                    "party_identifier",
                                    "contract_type_id",
                                    "subject",
                                    "sign_date",
                                    "branch_id",
                                    "currency",
                                    "status",
                                    "payment_type"
                                ],
                                "properties": {
                                    "party_name": {
                                        "description": "მეორე მხარის სახელი (legacy)",
                                        "type": "string",
                                        "example": "შპს ალფა"
                                    },
                                    "party_identifier": {
                                        "description": "იდენტიფიკატორი 9-11 ციფრი",
                                        "type": "string",
                                        "example": "123456789"
                                    },
                                    "contractor_id": {
                                        "description": "კონტრაქტორის ID (ნებაყოფლობითი)",
                                        "type": "integer",
                                        "example": 1,
                                        "nullable": true
                                    },
                                    "contract_number": {
                                        "description": "ხელშეკრულების ნომერი (უნიკალური)",
                                        "type": "string",
                                        "example": "CNT-2025-0003",
                                        "nullable": true
                                    },
                                    "contract_type_id": {
                                        "description": "ხელშეკრულების ტიპი",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "subject": {
                                        "description": "საგანი/შინაარსი",
                                        "type": "string",
                                        "example": "სერვისების მიწოდება და მხარდაჭერა"
                                    },
                                    "sign_date": {
                                        "description": "ხელმოწერის თარიღი",
                                        "type": "string",
                                        "format": "date",
                                        "example": "2025-09-10"
                                    },
                                    "expiry_date": {
                                        "description": "ვადის თარიღი (>= sign_date)",
                                        "type": "string",
                                        "format": "date",
                                        "example": "2026-09-10",
                                        "nullable": true
                                    },
                                    "branch_id": {
                                        "description": "ფილიალი",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "department_id": {
                                        "description": "დეპარტამენტი",
                                        "type": "integer",
                                        "example": 1,
                                        "nullable": true
                                    },
                                    "currency": {
                                        "description": "ვალუტა ISO 4217",
                                        "type": "string",
                                        "example": "GEL"
                                    },
                                    "amount": {
                                        "description": "თანხა",
                                        "type": "number",
                                        "format": "float",
                                        "example": 12000,
                                        "nullable": true
                                    },
                                    "status": {
                                        "description": "სტატუსი (default: დასამტკიცებელი)",
                                        "type": "string",
                                        "example": "დასამტკიცებელი"
                                    },
                                    "responsible_manager_id": {
                                        "description": "პასუხისმგებელი მენეჯერი (users.id)",
                                        "type": "integer",
                                        "example": null,
                                        "nullable": true
                                    },
                                    "initiator_id": {
                                        "description": "ინიციატორი (initiators.id)",
                                        "type": "integer",
                                        "example": 1,
                                        "nullable": true
                                    },
                                    "payment_type": {
                                        "description": "გადახდის ტიპი",
                                        "type": "string",
                                        "example": "ერთჯერადი"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Created"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contracts/{id}/attachments": {
            "get": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტზე მიმაგრებული ფაილების სია",
                "operationId": "97e2438635edc463044a324ff7d61cf5",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "post": {
                "tags": [
                    "Contracts"
                ],
                "summary": "ფაილების ატვირთვა კონტრაქტზე (მხარდაჭერა მრავალში)",
                "operationId": "8fe40b851ac0b5931a80dc57770eccd0",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "multipart/form-data": {
                            "schema": {
                                "properties": {
                                    "files[]": {
                                        "description": "ერთზე მეტი ფაილი (pdf/doc/docx/xlsx/csv, ≤50MB თითოეული)",
                                        "type": "array",
                                        "items": {
                                            "type": "string",
                                            "format": "binary"
                                        }
                                    },
                                    "file": {
                                        "description": "ერთეული ფაილი (ალტერნატიული ველი)",
                                        "type": "string",
                                        "format": "binary"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "201": {
                        "description": "Uploaded"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contracts/export": {
            "get": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტების ექსპორტი CSV/XLSX/PDF",
                "operationId": "eb237ab3346231149b869ec53daab646",
                "parameters": [
                    {
                        "name": "format",
                        "in": "query",
                        "description": "ექსპორტის ფორმატი (ფილტრებიც მოქმედებს)",
                        "required": true,
                        "schema": {
                            "type": "string",
                            "enum": [
                                "csv",
                                "xlsx",
                                "pdf"
                            ]
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "File stream"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        },
        "/api/contracts/{id}": {
            "put": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტის განახლება",
                "operationId": "c61602101aab0981a7e307f867771f98",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "requestBody": {
                    "required": true,
                    "content": {
                        "application/json": {
                            "schema": {
                                "properties": {
                                    "party_name": {
                                        "description": "მეორე მხარის სახელი (legacy)",
                                        "type": "string",
                                        "example": "შპს ალფა"
                                    },
                                    "party_identifier": {
                                        "description": "იდენტიფიკატორი 9-11 ციფრი",
                                        "type": "string",
                                        "example": "123456789"
                                    },
                                    "contractor_id": {
                                        "description": "კონტრაქტორის ID",
                                        "type": "integer",
                                        "example": 2,
                                        "nullable": true
                                    },
                                    "contract_number": {
                                        "description": "ხელშეკრულების ნომერი (უნიკალური)",
                                        "type": "string",
                                        "example": "CNT-2025-0003",
                                        "nullable": true
                                    },
                                    "contract_type_id": {
                                        "description": "ხელშეკრულების ტიპი",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "subject": {
                                        "description": "საგანი/შინაარსი",
                                        "type": "string",
                                        "example": "განახლებული აღწერა"
                                    },
                                    "sign_date": {
                                        "description": "ხელმოწერის თარიღი",
                                        "type": "string",
                                        "format": "date",
                                        "example": "2025-09-10"
                                    },
                                    "expiry_date": {
                                        "description": "ვადის თარიღი (>= sign_date)",
                                        "type": "string",
                                        "format": "date",
                                        "example": "2026-09-10",
                                        "nullable": true
                                    },
                                    "branch_id": {
                                        "description": "ფილიალი",
                                        "type": "integer",
                                        "example": 1
                                    },
                                    "department_id": {
                                        "description": "დეპარტამენტი",
                                        "type": "integer",
                                        "example": 3,
                                        "nullable": true
                                    },
                                    "currency": {
                                        "description": "ვალუტა ISO 4217",
                                        "type": "string",
                                        "example": "GEL"
                                    },
                                    "amount": {
                                        "description": "თანხა",
                                        "type": "number",
                                        "format": "float",
                                        "example": 15000,
                                        "nullable": true
                                    },
                                    "status": {
                                        "description": "სტატუსი",
                                        "type": "string",
                                        "example": "აქტიური"
                                    },
                                    "responsible_manager_id": {
                                        "description": "პასუხისმგებელი მენეჯერი",
                                        "type": "integer",
                                        "example": 1,
                                        "nullable": true
                                    },
                                    "initiator_id": {
                                        "description": "ინიციატორი (initiators.id)",
                                        "type": "integer",
                                        "example": 1,
                                        "nullable": true
                                    },
                                    "payment_type": {
                                        "description": "გადახდის ტიპი",
                                        "type": "string",
                                        "example": "ყოველთვიური"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    }
                },
                "responses": {
                    "200": {
                        "description": "OK"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            },
            "delete": {
                "tags": [
                    "Contracts"
                ],
                "summary": "კონტრაქტის წაშლა",
                "operationId": "ee05ce1a42af8edebde125bb5e110b85",
                "parameters": [
                    {
                        "name": "id",
                        "in": "path",
                        "required": true,
                        "schema": {
                            "type": "integer"
                        }
                    }
                ],
                "responses": {
                    "204": {
                        "description": "Deleted"
                    }
                },
                "security": [
                    {
                        "bearerAuth": []
                    }
                ]
            }
        }
    },
    "components": {
        "securitySchemes": {
            "bearerAuth": {
                "type": "http",
                "bearerFormat": "JWT",
                "scheme": "bearer"
            }
        }
    },
    "tags": [
        {
            "name": "Audit",
            "description": "Audit"
        },
        {
            "name": "Auth",
            "description": "Auth"
        },
        {
            "name": "Admin",
            "description": "Admin"
        },
        {
            "name": "Contractors",
            "description": "Contractors"
        },
        {
            "name": "Contracts",
            "description": "Contracts"
        }
    ]
}